<%- include('../partials/header.ejs') %>



<div class="container">
    <div class="container mt-5 mb-5" style="max-width: 100%;">
        <div class="row g-0">
          <div class="col-md-4">
            <% if (movie.Poster !== "N/A") { %>
                <img src="<%= movie.Poster %>" class="img-fluid rounded-start" alt="<% movie.Title %>'s release poster" class="card-img-top">
            <% } else { %>
                <p>No movie poster found... </p>
            <% } %>
          </div>
          <div class="col-md-8">
            <div class="card-body">
              <h2 class="card-title"><%= movie.Title %></h2>
              <p class="card-text text-start"><small class="text-body-secondary"></small><strong>Year:</strong> <%= movie.Year %></small></p>
              <p class="card-text text-start"><small class="text-body-secondary"></small><strong>Year:</strong> <%= movie.Director %></small></p>
              <p class="card-text text-start"><small class="text-body-secondary"></small><strong>Year:</strong> <%= movie.Actors %></small></p>
              <p class="card-text text-start"><small class="text-body-secondary"></small><strong>Rated:</strong> <%= movie.Rated %></small></p>
              <p class="card-text text-start"><small class="text-body-secondary"></small><strong>Genre:</strong> <%= movie.Genre %></small></p>
              <p class="card-text text-start"><small class="text-body-secondary"></small><strong>Summary:</strong> <%= movie.Plot %></small></p>
            </div>
            <div class="well">
                <form method="POST" action="/movies/<%= movie.imdbID %>/favorites">
                  <input hidden type="text" name="title" value="<%= movie.Title %>">
                  <input hidden type="text" name="imdbID" value="<%= movie.imdbID %>">
                  <button class="btn btn-primary" type="submit">Add to Favorite Movies</button>
                </form>
            </div>
            <div class="well">
                <h4>Leave a comment:</h4>
                <form method="POST" action="/comments">
                    <div class="form-group">
                        <input type="hidden" name="movieId" value="<%= movie.imdbID %>">
                        <div class="form-group">
                        <textarea type="text" class="form-control" id="content" name="content" placeholder="Add a comment..." required></textarea>
                        </div>
                    
                        <input type="submit" class="btn btn-primary">
                    </div>
                </form>
            </div>
          </div>
        </div>
      </div>
   <div class="container mt-5 mb-5">
        <div class="row hgith d-flex justify-content-center align-items-center">    
            <h3 class="text-start">Comments:</h3>
            <% if (comments.length > 0) { %>
                <% comments.forEach((comment, i) => { %>
                    <span>
                        <p class="text-start fw-semibold"><%= comment.user.email %>: </p>
                        <p><%= comment.content %></p>
                        <% if (locals.user && locals.user.id === comment.userId) { %>
                            <form method="GET" action="/comments/edit/<%= comment.id %>" style="display:inline;" >
                                <button type="submit" class="btn btn-sm btn-warning">Edit</button>
                            </form>
                            <form method="POST" action="/comments/<%= comment.id %>?_method=DELETE" style="display:inline;" >
                                <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                            </form>
                        <% } %>
                    </span>
                <% }) %>
            <% } else { %>
                <p>No comments yet.</p> 
            <% } %>
        </div>
    </div>
</div>






<%- include('../partials/footer.ejs') %>
